name: Update Bitable Prices

on:
  schedule:
    - cron: "*/15 * * * *"  # 每15分钟执行一次（UTC）
  workflow_dispatch:         # 允许手动运行

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run updater script
        run: python update_prices_single_table.py
        env:
          FEISHU_APP_ID: ${{ secrets.FEISHU_APP_ID }}
          FEISHU_APP_SECRET: ${{ secrets.FEISHU_APP_SECRET }}
          FEISHU_APP_TOKEN: ${{ secrets.FEISHU_APP_TOKEN }}
          TABLE_ID: ${{ secrets.TABLE_ID }}
          CODE_FIELD: ${{ secrets.CODE_FIELD }}
          PRICE_FIELD: ${{ secrets.PRICE_FIELD }}
          UPDATED_AT_FIELD: ${{ secrets.UPDATED_AT_FIELD }}
          # ... 你的工作流文件的其他部分 ...

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4 # 这一步是必须的，它会把你的整个仓库克隆到 runner 上

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # 根据你的项目需求设置 Python 版本

      - name: Install dependencies
        run: pip install -r .github/workflows/requirements.txt # <-- 修改这里！
        # 注意：这里是相对于仓库根目录的路径
        # 如果你的工作流文件和 requirements.txt 都在 .github/workflows/ 目录下，
        # 那么从仓库根目录看，requirements.txt 的路径就是 .github/workflows/requirements.txt

      - name: Run your script # 假设你要运行 update_prices_single_table.py
        run: python .github/workflows/update_prices_single_table.py # <-- 同样，指定完整路径
        # 或者，如果你想先 cd 到该目录再运行：
        # run: |
        #   cd .github/workflows
        #   python update_prices_single_table.py

# ... 你的工作流文件的其他部分 ...
